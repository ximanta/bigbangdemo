import React, { useState, useEffect } from 'react';import { useParams, useNavigate, Link } from 'react-router-dom';import { useEvents } from '../context/EventContext';import { useToast } from '../components/Toast';import { InputField } from '../components/InputField';import { TextAreaField } from '../components/TextAreaField';import { Button } from '../components/Button';import { Tabs } from '../components/Tabs';import { AgendaList } from '../components/AgendaList';import { DelegateList } from '../components/DelegateList';import { Modal } from '../components/Modal';import { LoadingSpinner } from '../components/LoadingSpinner';import { Plus } from 'lucide-react';export const EditEvent = () => {  const { id } = useParams();  const navigate = useNavigate();  const { events, updateEvent, deleteEvent, addSession, updateSession, deleteSession } = useEvents();  const { showToast } = useToast();  const event = events.find((e) => e.id === id);  const [eventData, setEventData] = useState(event ? { ...event } : null);  const [activeTab, setActiveTab] = useState('details');  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);  const [isSessionModalOpen, setIsSessionModalOpen] = useState(false);  const [currentSession, setCurrentSession] = useState(null); // For editing sessions  useEffect(() => {    if (event) {      setEventData({ ...event });    }  }, [event]);  if (!eventData) {    return <LoadingSpinner center />;  }  const handleChange = (e) => {    const { name, value } = e.target;    setEventData((prevData) => ({      ...prevData,      [name]: value    }));  };  const handleUpdateEvent = (e) => {    e.preventDefault();    if (new Date(eventData.startDate) > new Date(eventData.endDate)) {      showToast('End date cannot be before start date.', 'error');      return;    }    updateEvent(eventData);    showToast('Event updated successfully!', 'success');    navigate('/organizer');  };  const handleDeleteEvent = () => {    deleteEvent(id);    showToast('Event deleted successfully!', 'info');    setIsDeleteModalOpen(false);    navigate('/organizer');  };  const handleAddSessionClick = () => {    setCurrentSession(null); // Clear for new session    setIsSessionModalOpen(true);  };  const handleEditSessionClick = (sessionId) => {    const sessionToEdit = eventData.sessions.find(s => s.id === sessionId);    setCurrentSession(sessionToEdit);    setIsSessionModalOpen(true);  };  const handleDeleteSession = (sessionId) => {    if (window.confirm('Are you sure you want to delete this session?')) {      deleteSession(id, sessionId);      showToast('Session deleted successfully!', 'info');    }  };  const handleSaveSession = (session) => {    if (currentSession) {      updateSession(id, session);      showToast('Session updated successfully!', 'success');    } else {      addSession(id, session);      showToast('Session added successfully!', 'success');    }    setIsSessionModalOpen(false);    setCurrentSession(null);  };  const tabs = [    { id: 'details', label: 'Event Details' },    { id: 'agenda', label: 'Agenda' },    { id: 'delegates', label: `Delegates (${event.delegates.length})` }  ];  return (    <div className="container">      <div className="card">        <h1>Edit Event: {eventData.title}</h1>        <Tabs tabs={tabs} activeTab={activeTab} onTabChange={setActiveTab} />        <div className="tab-content" style={{ marginTop: 'var(--spacing-md)' }}>          {activeTab === 'details' && (            <form onSubmit={handleUpdateEvent}>              <InputField                label="Event Title"                id="title"                name="title"                value={eventData.title}                onChange={handleChange}                required              />              <TextAreaField                label="Description"                id="description"                name="description"                value={eventData.description}                onChange={handleChange}                placeholder="Provide a detailed description of your event."                required              />              <InputField                label="Location"                id="location"                name="location"                value={eventData.location}                onChange={handleChange}                required              />              <InputField                label="Start Date"                id="startDate"                name="startDate"                type="date"                value={eventData.startDate}                onChange={handleChange}                required              />              <InputField                label="End Date"                id="endDate"                name="endDate"                type="date"                value={eventData.endDate}                onChange={handleChange}                required              />              <div className="form-actions">                <Button onClick={() => navigate('/organizer')} variant="outline">                  Cancel                </Button>                <Button type="submit" variant="primary">                  Save Changes                </Button>                <Button                  type="button"                  variant="danger"                  onClick={() => setIsDeleteModalOpen(true)}                >                  Delete Event                </Button>              </div>            </form>          )}          {activeTab === 'agenda' && (            <>              <div style={{ marginBottom: 'var(--spacing-md)', textAlign: 'right' }}>                <Button variant="primary" onClick={handleAddSessionClick}>                  <Plus size={20} />                  Add Session                </Button>              </div>              <AgendaList                sessions={eventData.sessions}                onEditSession={handleEditSessionClick}                onDeleteSession={handleDeleteSession}                isOrganizerView={true}              />            </>          )}          {activeTab === 'delegates' && (            <DelegateList delegates={eventData.delegates} />          )}        </div>      </div>      <Modal        isOpen={isDeleteModalOpen}        onClose={() => setIsDeleteModalOpen(false)}        title="Confirm Deletion"        actions={(          <>            <Button onClick={() => setIsDeleteModalOpen(false)} variant="outline">              Cancel            </Button>            <Button onClick={handleDeleteEvent} variant="danger">              Delete            </Button>          </        >        )}      >        <p>Are you sure you want to delete the event "{eventData.title}"? This action cannot be undone.</p>      </Modal>      <SessionFormModal        isOpen={isSessionModalOpen}        onClose={() => setIsSessionModalOpen(false)}        onSave={handleSaveSession}        initialSession={currentSession}        eventDateRange={{          startDate: eventData.startDate,          endDate: eventData.endDate        }}      />    </div>  );};const SessionFormModal = ({ isOpen, onClose, onSave, initialSession, eventDateRange }) => {  const { showToast } = useToast();  const [sessionForm, setSessionForm] = useState(initialSession || {    title: '',    speaker: '',    description: '',    date: '',    startTime: '',    endTime:  ''  });  useEffect(() => {    setSessionForm(initialSession || {      title: '',      speaker: '',      description: '',      date: '',      startTime: '',      endTime: ''    });  }, [initialSession]);  const handleChange = (e) => {    const { name, value } = e.target;    setSessionForm((prev) => ({ ...prev, [name]: value }));  };  const handleSubmit = (e) => {    e.preventDefault();    if (sessionForm.date < eventDateRange.startDate || sessionForm.date > eventDateRange.endDate) {      showToast(`Session date must be between ${eventDateRange.startDate} and ${eventDateRange.endDate}.`, 'error');      return;    }    if (sessionForm.startTime >= sessionForm.endTime) {      showToast('Session end time must be after start time.', 'error');      return;    }    onSave(sessionForm);  };  return (    <Modal      isOpen={isOpen}      onClose={onClose}      title={initialSession ? 'Edit Session' : 'Add New Session'}      actions={(        <>          <Button onClick={onClose} variant="outline">            Cancel          </Button>          <Button type="submit" form="session-form" variant="primary">            {initialSession ? 'Save Changes' : 'Add Session'}          </Button>        </>      )}    >      <form id="session-form" onSubmit={handleSubmit}>        <InputField          label="Session Title"          id="sessionTitle"          name="title"          value={sessionForm.title}          onChange={handleChange}          required        />        <InputField          label="Speaker Name"          id="sessionSpeaker"          name="speaker"          value={sessionForm.speaker}          onChange={handleChange}        />        <TextAreaField          label="Description"          id="sessionDescription"          name="description"          value={sessionForm.description}          onChange={handleChange}          required        />        <InputField          label="Date"          id="sessionDate"          name="date"          type="date"          value={sessionForm.date}          onChange={handleChange}          min={eventDateRange.startDate}          max={eventDateRange.endDate}          required        />        <InputField          label="Start Time"          id="sessionStartTime"          name="startTime"          type="time"          value={sessionForm.startTime}          onChange={handleChange}          required        />        <InputField          label="End Time"          id="sessionEndTime"          name="endTime"          type="time"          value={sessionForm.endTime}          onChange={handleChange}          required        />      </form>    </Modal>  );};