import React, { useState } from 'react';import { Plus, Send, Calendar, Eye } from 'lucide-react';import Card from '../../components/Card';import Button from '../../components/Button';import InputField from '../../components/InputField';import SelectField from '../../components/SelectField';import Modal from '../../components/Modal';import Checkbox from '../../components/Checkbox';import { mockArticles, mockNewsletters, mockSubscribers } from '../../data/mockData';import { generateUniqueId, formatDateTime } from '../../utils/helpers';import Notification from '../../components/Notification';const NewsletterCreation = () => {  const [newsletters, setNewsletters] = useState(mockNewsletters);  const [form, setForm] = useState({    title: '',    subject: '',    scheduledDate: '',    scheduledTime: '',    selectedArticleIds: [],    recipientType: 'all'  });  const [isArticleSelectorOpen, setIsArticleSelectorOpen] = useState(false);  const [availableArticles, setAvailableArticles] = useState(mockArticles.filter(a => a.status === 'Approved'));  const [notification, setNotification] = useState(null);  const handleInputChange = (e) => {    const { id, value } = e.target;    setForm(prev => ({ ...prev, [id]: value }));  };  const handleArticleSelection = (articleId) => {    setForm(prev => ({      ...prev,      selectedArticleIds: prev.selectedArticleIds.includes(articleId)        ? prev.selectedArticleIds.filter(id => id !== articleId)        : [...prev.selectedArticleIds, articleId]    }));  };  const openArticleSelector = () => setIsArticleSelectorOpen(true);  const closeArticleSelector = () => setIsArticleSelectorOpen(false);  const handleSaveArticles = () => {    // Articles are already updated in form.selectedArticleIds by handleArticleSelection    closeArticleSelector();  };  const handleSubmit = (e) => {    e.preventDefault();    if (!form.title || !form.subject || form.selectedArticleIds.length === 0) {      setNotification({ message: 'Please fill all required fields and select articles.', type: 'error' });      return;    }    const scheduledDateTime = form.scheduledDate && form.scheduledTime      ? new Date(`${form.scheduledDate}T${form.scheduledTime}:00Z`).toISOString()      : new Date().toISOString(); // Default to now if not scheduled    const newNewsletter = {      id: generateUniqueId(),      title: form.title,      subject: form.subject,      scheduledDate: scheduledDateTime,      status: form.scheduledDate ? 'Scheduled' : 'Sent',      articles: form.selectedArticleIds,      recipients: form.recipientType === 'all'        ? mockSubscribers.filter(s => s.status === 'Active').map(s => s.id)        : [] // In a real app, this would be more complex    };    setNewsletters(prev => [...prev, newNewsletter]);    setNotification({ message: 'Newsletter created and scheduled/sent!', type: 'success' });    setForm({      title: '',      subject: '',      scheduledDate: '',      scheduledTime: '',      selectedArticleIds: [],      recipientType: 'all'    });  };  const getArticleDetails = (id) => mockArticles.find(a => a.id === id);  const newsletterPreviewContent = () => {    const selectedArticlesDetails = form.selectedArticleIds.map(getArticleDetails).filter(Boolean);    return (      <div>        <h2 className="text-xl font-semibold mb-2">{form.title || 'Untitled Newsletter'}</h2>        <p className="text-muted mb-4">Subject: {form.subject || 'No Subject'}</p>        <p className="font-medium mb-2">Editor's Note:</p>        <div className="rte-editor mb-4" style={{ minHeight: '80px', background: '#f8f8f8', border: 'none' }}>          <p>This is a custom editorial note. In a real application, this would be a rich text editor output.</p>        </div>        {selectedArticlesDetails.length > 0 ? (          <div className="grid-container grid-col-2">            {selectedArticlesDetails.map(article => (              <Card key={article.id} className="mb-2">                <h4 className="font-semibold mb-1">{article.title}</h4>                <p className="text-sm text-muted">                  {article.sourceName} - {formatDateTime(article.date)}                </p>                {article.image && (                  <img src={article.image} alt={article.title} className="w-full rounded mt-2" style={{ maxHeight: '100px', objectFit: 'cover' }} />                )}                <p className="text-sm mt-2">                  {article.content.substring(0, 100)}...                </p>                <Button variant="link" onClick={() => console.log('Read more:', article.id)} className="mt-2">                  Read More                </Button>              </Card>            ))}          </div>        ) : (          <p className="text-muted text-center">No articles selected for this newsletter.</p>        )}        <p className="text-sm text-muted mt-4 text-center">          &copy; {new Date().getFullYear()} News Aggregator Newsletter. All rights reserved.        </p>      </div>    );  };  const [isPreviewModalOpen, setIsPreviewModalOpen] = useState(false);  const openPreviewModal = () => setIsPreviewModalOpen(true);  const closePreviewModal = () => setIsPreviewModalOpen(false);  return (    <div>      <Card title="Create New Newsletter">        <form onSubmit={handleSubmit}>          <InputField            label="Newsletter Title"            id="title"            value={form.title}            onChange={handleInputChange}            placeholder="e.g., Daily Tech Digest"            required          />          <InputField            label="Email Subject Line"            id="subject"            value={form.subject}            onChange={handleInputChange}            placeholder="Your daily dose of news!"            required          />          <div className="input-field-group">            <label>Scheduled Delivery</label>            <div className="flex-container gap-4">              <InputField                id="scheduledDate"                type="date"                value={form.scheduledDate}                onChange={handleInputChange}                className="flex-grow"              />              <InputField                id="scheduledTime"                type="time"                value={form.scheduledTime}                onChange={handleInputChange}                className="flex-grow"              />            </div>          </div>          <div className="input-field-group">            <label>Selected Articles ({form.selectedArticleIds.length})</label>            <div className="flex-container items-center gap-2">              <div className="flex-grow border rounded p-2 text-muted">                {form.selectedArticleIds.length > 0                  ? `${form.selectedArticleIds.length} articles selected`                  : 'No articles selected'}              </div>              <Button type="button" variant="secondary" onClick={openArticleSelector}>                <Plus size={18} className="mr-2" /> Select Articles              </Button>            </div>          </div>          <div className="input-field-group">            <label>Custom Editorial Notes</label>            <div className="rte-editor">              {/* Placeholder for a Rich Text Editor */}              <textarea                style={{ width: '100%', minHeight: '100px', border: 'none', resize: 'vertical' }}                placeholder="Add custom introduction or closing remarks..."              ></textarea>            </div>          </div>          <SelectField            label="Recipients"            id="recipientType"            value={form.recipientType}            onChange={handleInputChange}            options={[              { value: 'all', label: 'All Active Subscribers' },              { value: 'byTopic', label: 'Subscribers by Topic (not implemented in demo)' }            ]}          />          <div className="flex-container justify-end gap-2 mt-6">            <Button type="button" variant="secondary" onClick={openPreviewModal}>              <Eye size={18} className="mr-2" /> Preview Newsletter            </Button>            <Button type="submit" variant="primary">              <Send size={18} className="mr-2" /> {form.scheduledDate ? 'Schedule Newsletter' : 'Send Now'}            </Button>          </div>        </form>      </Card>      <Modal        isOpen={isArticleSelectorOpen}        onClose={closeArticleSelector}        title="Select Articles"        footerButtons={[          { label: 'Cancel', variant: 'secondary', onClick: closeArticleSelector },          { label: 'Add Selected Articles', variant: 'primary', onClick: handleSaveArticles }        ]}      >        <div style={{ maxHeight: '400px', overflowY: 'auto' }}>          {availableArticles.length === 0 ? (            <p className="text-center text-muted">No approved articles available.</p>          ) : (            availableArticles.map(article => (              <div key={article.id} className="checkbox-group mb-2">                <Checkbox                  id={`article-${article.id}`}                  checked={form.selectedArticleIds.includes(article.id)}                  onChange={() => handleArticleSelection(article.id)}                />                <label htmlFor={`article-${article.id}`}>                  {article.title} <span className="text-muted">({article.sourceName})</span>                </label>              </div>            ))          )}        </div>      </Modal>      <Modal        isOpen={isPreviewModalOpen}        onClose={closePreviewModal}        title="Newsletter Preview"        footerButtons={[          { label: 'Close', variant: 'secondary', onClick: closePreviewModal }        ]}      >        <div className="p-4 border rounded" style={{ backgroundColor: '#fdfdfd' }}>          {newsletterPreviewContent()}        </div>      </Modal>      {notification && (        <Notification          message={notification.message}          type={notification.type}          onClose={() => setNotification(null)}        />      )}    </div>  );};export default NewsletterCreation;