import React, { useState, useEffect } from 'react';import { useNavigate } from 'react-router-dom';import Button from '../components/Button.jsx';import ProgressBar from '../components/ProgressBar.jsx';import RadioGroup from '../components/RadioGroup.jsx';import Checkbox from '../components/Checkbox.jsx';import Slider from '../components/Slider.jsx';import NumberPicker from '../components/NumberPicker.jsx';import Dropdown from '../components/Dropdown.jsx';import { questions } from '../utils/mockData.js';import { calculateBiologicalAge } from '../utils/biologicalAgeAlgorithm.js';function Questionnaire({userProfile, onComplete, currentAnswers, setCurrentAnswers, showToast}) {const navigate = useNavigate();const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);const currentQuestion = questions[currentQuestionIndex];useEffect(() => {if (!userProfile || !userProfile.dateOfBirth) {showToast('Please complete your profile first.', 'error');navigate('/profile-setup');}}, [userProfile, navigate, showToast]);const handleAnswerChange = (questionId, value) => {setCurrentAnswers((prevAnswers) => ({...prevAnswers,[questionId]: value,}));};const handleNext = () => {if (currentQuestionIndex < questions.length - 1) {const answer = currentAnswers[currentQuestion.id];if (currentQuestion.type === 'checkbox') {if (!answer || answer.length === 0) {showToast('Please select at least one option.', 'error');return;}} else {if (!answer && answer !== 0) {showToast('Please select an answer.', 'error');return;}}setCurrentQuestionIndex((prevIndex) => prevIndex + 1);} else {handleSubmit();}};const handlePrevious = () => {if (currentQuestionIndex > 0) {setCurrentQuestionIndex((prevIndex) => prevIndex - 1);}};const handleSubmit = () => {if (!userProfile) {showToast('User profile not found.', 'error');navigate('/profile-setup');return;}// Final validation for the last questionconst lastAnswer = currentAnswers[currentQuestion.id];if (currentQuestion.type === 'checkbox') {if (!lastAnswer || lastAnswer.length === 0) {showToast('Please select at least one option for the last question.', 'error');return;}} else {if (!lastAnswer && lastAnswer !== 0) {showToast('Please select an answer for the last question.', 'error');return;}}// Calculate biological ageconst biologicalAge = calculateBiologicalAge(userProfile, currentAnswers);if (biologicalAge === null) {showToast('Could not calculate biological age. Please ensure your profile is complete.', 'error');navigate('/profile-setup');return;}const actualAge = ((new Date()).getFullYear() - (new Date(userProfile.dateOfBirth)).getFullYear());onComplete({ actualAge, biologicalAge, answers: currentAnswers });};const renderQuestionInput = (question) => {const value = currentAnswers[question.id];switch (question.type) {case 'radio':return (<RadioGrouplabel={question.text}name={question.id}options={question.options}selectedValue={value}onChange={(val) => handleAnswerChange(question.id, val)}/>);case 'checkbox':return (<div className="form-group"><label className="label">{question.text}</label><div className="checkbox-group">{question.options.map((option) => (<Checkboxkey={option.value}label={option.label}name={question.id}value={option.value}checked={value && value.includes(option.value)}onChange={(e) => {const newValues = e.target.checked? [...(value || []), e.target.value]: (value || []).filter((v) => v !== e.target.value);handleAnswerChange(question.id, newValues);}}/>))}<div/></div>);case 'slider':return (<Sliderlabel={question.text}value={value || question.min}onChange={(val) => handleAnswerChange(question.id, val)}min={question.min}max={question.max}step={question.step}labels={question.labels}/>);case 'number':return (<NumberPickerlabel={question.text}value={value === undefined ? question.min : value}onChange={(val) => handleAnswerChange(question.id, val)}min={question.min}max={question.max}step={question.step}/>);case 'dropdown':return (<Dropdownlabel={question.text}name={question.id}value={value || ''}options={question.options}onChange={(e) => handleAnswerChange(question.id, e.target.value)}/>);default:return <p>Unknown question type.</p>;}};if (!currentQuestion) {return <p className="text-center page-content">No questions available.</p>;}return (<div className="container page-content"><h2 className="text-center card-title">Health Assessment</h2><ProgressBar current={currentQuestionIndex + 1} total={questions.length} /><p className="text-center mb-20">Question {currentQuestionIndex + 1} of {questions.length}</p><div className="card"><div className="card-body">{renderQuestionInput(currentQuestion)}</div><div className="card-footer flex justify-center gap-10"><Buttonvariant="secondary"onClick={handlePrevious}disabled={currentQuestionIndex === 0}>Previous</Button><Buttonvariant="primary"onClick={handleNext}>{currentQuestionIndex === questions.length - 1 ? 'Submit Assessment' : 'Next'}</Button></div></div></div>);}.form-group {margin-bottom: 20px;}.label {display: block;margin-bottom: 8px;font-weight: bold;color: var(--text-color);}export default Questionnaire;